---
title: "Svelteã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆäº‹æƒ… ï¼ˆ2021å¹´12æœˆç‰ˆï¼‰"
emoji: "ğŸ“™"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Svelte", "TypeScript", "Jest"]
published: false
---

:::message alert
æœ¬è¨˜äº‹ã®æ‰‹é †ã¯ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒ TypeScript ã§æ›¸ã‹ã‚Œã‚‹å‰æã®æ‰‹é †ã¨ãªã‚Šã¾ã™ã€‚
ç”Ÿã® JavaScript ã‚’æ¡ç”¨ã™ã‚‹å ´åˆã¯ã€ [Svelte Testing Library ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://testing-library.com/docs/svelte-testing-library/setup)ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
:::

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ [Svelte Advent Calendar 2021](https://qiita.com/advent-calendar/2021/svelte) ã® 22 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚
ç­†è€…ã¯ä»•äº‹ã®é–¢ä¿‚ã‚‚ã‚ã‚Šã€æœ€è¿‘æœ¬æ ¼çš„ã« React/Vue ã§ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’æ›¸ãã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼ˆ~~ãˆã£ä»Šæ›´ã™ãã‚‹ã ã£ã¦ï¼Ÿã¡ã‚‡ã£ã¨è‰²ã€…è¨³ãŒã‚ã£ã¦ãªâ€¦~~ï¼‰ã€‚ãã®æµã‚Œã§ã€ãã†ã„ãˆã° Svelte ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆäº‹æƒ…ã©ã†ãªã£ã¦ã„ã‚‹ã®ã ã‚ã†ã¨è€ƒãˆã‚‹ã‚ˆã†ã«ãªã‚Šã€æ›¸ãæ–¹ã®å‹‰å¼·ã‚‚å…¼ã­ã¦æœ¬è¨˜äº‹ã‚’æ›¸ãã“ã¨ã«ã—ã¾ã—ãŸã€‚

# Svelte ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’æ›¸ãæ–¹æ³•

https://svelte.dev/faq#how-do-i-test-svelte-apps

å…¬å¼ Q&A ã®ã€ŒHow do I test Svelte appsï¼Ÿã€ã«ã¯æ¬¡ã®æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [Svelte Testing Library](https://testing-library.com/docs/svelte-testing-library/example/)ã‚’ä½¿ã†æ–¹æ³•
- [uvu](https://github.com/lukeed/uvu/tree/master/examples/svelte)ã‚’ä½¿ã†æ–¹æ³•

ãŸã ã—ã€å¾Œè¿°ã™ã‚‹ Svelte Society ã®å…¬å¼ãƒ¬ã‚·ãƒ”ãªã©å‰è€…ã®æ–¹æ³•ã§ç´¹ä»‹ã•ã‚Œã‚‹ã“ã¨ãŒæ®†ã©ã§ã€Testing Library ã‚’ä½¿ãˆã°å•é¡Œãªã„ã§ã™ï¼ˆå®Ÿéš›ã€Svelte ã®ã‚³ã‚¢ãƒ¡ãƒ³ãƒãƒ¼ãŒ Svelte Testing Library ã®å…¬å¼ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã—ã¦ãŸã‚Šã™ã‚‹ï¼‰ã€‚

# Svelte Testing Library ã«ã¤ã„ã¦

React ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã‚‹äººã«ã¯ãŠé¦´æŸ“ã¿ï¼ˆã ã¨æ€ã„ãŸã„ï¼‰[Testing Library](https://testing-library.com/)ã® Svelte ç‰ˆã«ãªã‚Šã¾ã™ã€‚æ­£ç›´ãªã¨ã“ã‚ã€ãã®èªè­˜ã ã‘ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

## æ›¸ãæ–¹

åŸºæœ¬çš„ãªæ›¸ãæ–¹ã¯æ¬¡ã®ã‚µã‚¤ãƒˆã‚’è¦‹ã‚Œã°å•é¡Œãªã„ã§ã™ã€‚Context API ã‚„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æŒã£ã¦ã„ã‚‹æƒ…å ±ã®å–å¾—/å©ãæ–¹ãŒã¡ã‚‡ã£ã¨ç‰¹æ®Šãªãã‚‰ã„ã§ã™ã€‚
Svelte è‡ªä½“ã€React ä»¥ä¸Šã«å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é¸æŠè‚¢ãŒå¹…åºƒã„ãŸã‚ã€ã¡ã‚‡ã£ã¨ç‰¹æ®Šãªæ›¸ãæ–¹ã‚’ã—ãŸããªã£ãŸã¨ãã¯[React Testing Library](https://testing-library.com/docs/react-testing-library/example-intro)ã‚‚å‚è€ƒã«ã—ãªãŒã‚‰æ›¸ã„ã¦ã„ã‘ã°ã€ã‚ã¾ã‚Šè¿·ã†ã“ã¨ãªãæ›¸ã‘ã‚‹ã‹ã¨ã€‚

https://testing-library.com/docs/svelte-testing-library/example/
https://sveltesociety.dev/recipes/testing-and-debugging/unit-testing-svelte-component

## ç’°å¢ƒæ§‹ç¯‰

ã“ã“ãŒä¸€ç•ªã®é¬¼é–€ã§ã™ï¼ˆç‰¹ã« TypeScript ã§æ›¸ãã¨ãªã‚‹å ´åˆï¼‰ã€‚æ®‹å¿µãªãŒã‚‰ã€React ã§ã® `create-react-app`ã€Vue ã® `Vue CLI` ã®ã‚ˆã†ãªå½¢ã§ã€Svelte ã§ã¯å…¬å¼ã‹ã‚‰æ¥½ã«è¨­å®šã—ã¦ãã‚Œã‚‹æ–¹æ³•ã¯ç¾çŠ¶æä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“â€¦ã€‚ä¸€å¿œã‚‚ã†å°‘ã—æ¥½ã«è¨­å®šã™ã‚‹æ–¹æ³•ã¯ã‚ã‚‹ãŸã‚ã€ä»Šå›ã¯ Svelte Testing Library å…¬å¼ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹æ‰‹é †ã¨ã€æœ‰å¿—ä½œæˆã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½¿ã£ã¦æ¥½ã‚ã«è¨­å®šã™ã‚‹æ–¹æ³•ã® 2 ã¤ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

### å…¬å¼ã«æ²¿ã£ãŸæ‰‹é †

åŸºæœ¬çš„ã«ã¯ã€Svelte Testing Library ã® Setup ãƒšãƒ¼ã‚¸ã¨ svelte-jester ã® README ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

https://testing-library.com/docs/svelte-testing-library/setup
https://github.com/mihar-22/svelte-jester

ãŸã ã—ã“ã‚Œã ã¨è¤‡æ•°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ¨ªæ–­ã—ãªã‘ã‚Œã°ã„ã‘ãšã€ã‚ã‹ã‚Šã«ãã‹ã£ãŸãŸã‚ã€ã“ã¡ã‚‰ã®è¨˜äº‹ã‚‚å‚è€ƒã«ã—ã¾ã—ãŸã€‚
ï¼ˆ`babel` ã‚„ `jest` ã®è¨­å®šã€ `svelte-preprocess` å‘¨ã‚Šæœ¬å½“ã«å¼±ã„ã®ã§å‹‰å¼·ã—ãªã‘ã‚Œã°â€¦ï¼‰
https://daveceddia.com/svelte-typescript-jest/

#### 1. Svelte + TypeScript ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”Ÿæˆ

ä»Šå›ã¯ `svelte-typescript-test` ã¨ã„ã†ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã§ä½œæˆã™ã‚‹ã®ã§ã€`npx degit` ã‚³ãƒãƒ³ãƒ‰ã§ã“ã¡ã‚‰ã®åç§°ã‚’æŒ‡å®šã—ã€ä½œæˆã—ã¾ã™ã€‚

```bash
npx degit sveltejs/template svelte-typescript-test

cd svelte-typescript-test
node scripts/setupTypeScript.js
yarn install # OR npm install
```

#### 2. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆæ›¸ãã®ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ã€‚ã€Œãˆã£å¤šããªã„â€¦ã€ã£ã¦ãªã‚Šãã†ã§ã™ãŒã€ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ä»¥ä¸Šã€ä»•æ–¹ãªã„ã‹ã¨ã€‚

##### ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåã®é ­ã«ã¤ã„ã¦

- TypeScript ã‚’ä½¿ã†å ´åˆã®ã¿å¿…è¦ã«ãªã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯ã€ â˜† ãŒã¤ã„ã¦ã„ã¾ã™
- TypeScript ã®ã¿ã§ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒãªã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯ã€ â–³ ãŒã¤ã„ã¦ã„ã¾ã™

```
- jest : ã”å­˜çŸ¥ãƒ•ãƒ­ãƒ³ãƒˆã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«
- â˜† ts-jest : TypeScriptã§Jestã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- @testing-library/svelte : Svelte Testing Libraryæœ¬ä½“
- @testing-library/jest-dom : toBeInTheDocumentãªã©DOMè¦ç´ é–¢ä¿‚ã®Testing Library
- svelte-jester : .svelteãƒ•ã‚¡ã‚¤ãƒ«ã§Jestã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- â˜† @types/jest : Jestã®å‹å®šç¾©
- â–³ babel-jest : JavaScriptã§Jestã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- â–³ @babel/preset-env : babel-jestã¨ã‚»ãƒƒãƒˆã§ä½¿ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
```

ãã‚Œã§ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚ä»Šå›ã¯ vanilla js ã§ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãäºˆå®šã¯ãªã„ã®ã§ã€`babel-jest`/`@babel/preset-env` ã«ã¤ã„ã¦ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã›ã‚“ã€‚

```bash
yarn add -D \
    jest ts-jest \
    @testing-library/svelte @testing-library/jest-dom \
    svelte-jester @types/jest

# OR npm npm install --save-dev
```

#### 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

ã¾ãš `package.json` ã« Jest ç”¨ã® script ã‚’è¿½åŠ ã—ã¦ãŠãã¾ã™ã€‚
`--watch` ã‚’ã¤ã‘ã¦ãŠãã¨ã€Jest ãŒãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã¦ãã‚Œã‚‹ã®ã§ä¾¿åˆ©ã§ã™ã€‚

```diff json:package.json
{
  "scripts": {
    ...
+   "test": "jest",
+   "test:watch": "npm test --watch"
  }
}
```

`package.json` ã«ã•ã‚‰ã«è¿½åŠ ã—ã¾ã™ã€‚
`babel-jest` ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãªã„ã®ã§ã€`transform` ã®ä¸­ã«æŒ‡å®šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸€æ–¹ã€`moduleFileExtensions` ã«ã¯å¿…ãš `js` ã‚’æŒ‡å®šã—ãªã„ã¨ã„ã‘ãªã„ãŸã‚ã€å…¥ã‚Œã¦ãŠãã¾ã™ã€‚ã•ã‚‰ã« `@testing-library/jest-dom` ã‚’ä½¿ã†é–¢ä¿‚ã§ã€`testEnvironment` ã‚‚æŒ‡å®šã—ã¦ãŠãã¾ã™ã€‚

â€»ã“ã“ã¯ `package.json` ã§ã¯ãªãã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã« `jest.config.js` ã‚’ä½œæˆã—ã¦ã€`"transform": {` ä»¥é™ã®å†…å®¹ã‚’è¿½è¨˜ã—ã¦ã‚‚å¤§ä¸ˆå¤«ã‹ã¨ã€‚

```diff json:package.json
{
  "scripts": {
    ...
+   "jest": {
+     "transform": {
+       "^.+\\.svelte$": [
+         "svelte-jester",
+         {
+           "preprocess": true
+         }
+       ],
+       "^.+\\.ts$": "ts-jest"
+     },
+     "moduleFileExtensions": [
+       "js",
+       "ts",
+       "svelte"
+     ],
+     "testEnvironment": "jsdom"
+   }
  }
}
```

`package.json` ã¸ã®è¿½è¨˜ã¯ã“ã“ã¾ã§ã§ã™ã€‚
æ¬¡ã¯ `svelte.config.js` ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã«æ–°è¦ã§ä½œæˆã—ã¾ã™ã€‚`svelte-preprocess` ã¯ Svelte ã‚¢ãƒ—ãƒªã®ä½œæˆã—ãŸéš›ã«ã€ä¸€ç·’ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ãŸã‚ã€æ°—ã«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

TypeScript ã ã‘ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã™ã‚‹å ´åˆã€ä½œæˆã—ãªãã¦ã‚‚é€šã£ãŸã¨ã„ã†æƒ…å ±ã‚‚ã‚ã‚Šã¾ã—ãŸãŒã€ã“ã¡ã‚‰ã®ç’°å¢ƒã ã¨ã€ãªã„ã¨ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã§ãã¾ã›ã‚“ã§ã—ãŸâ€¦ã€‚

```diff js:svelte.config.js
+  const sveltePreprocess = require("svelte-preprocess");
+
+  module.exports = {
+    preprocess: sveltePreprocess(),
+  };
```

æœ€å¾Œã« `tsconfig.json` ã¸ 3 è¡Œè¿½è¨˜ã—ã¾ã™ã€‚
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ `@types/jest` ã‚’ã“ã“ã«æŒ‡å®šã™ã‚‹ã“ã¨ã§ Jest ã®å‹å®šç¾©ãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ã«æœ‰åŠ¹åŒ–ã•ã‚Œã¾ã™ã€‚

```diff json:tsconfig.json
{
   ...
+  "compilerOptions": {
+   "types": ["jest"]
+  }
}
```

è¨­å®šã¯ä»¥ä¸Šã§ã™ã€‚

#### 4. Svelte ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã

ã‚ˆã†ã‚„ãæœ¬é¡Œã§ã™ã€‚

ä»Šå›ã¯ Svelte Testing Library ç‰¹æœ‰ã®æ›¸ãæ–¹ã®ã¿å–ã‚Šä¸Šã’ã€Jest ã®æ›¸ãæ–¹ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã«é–¢ã—ã¦ã®èª¬æ˜ã¯çœç•¥ã—ã¾ã™ã€‚

ã¾ãšã¯ã€Œ1. Svelte + TypeScript ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”Ÿæˆã€ã§ç”Ÿæˆã•ã‚ŒãŸ `App.svelte` ã«ã‚ã‚‹ `name` ã¨ã„ã† `props` ã«é©å½“ãªæ–‡å­—åˆ—ã‚’æ¸¡ã—ãŸã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«è¡¨ç¤ºã•ã‚Œã‚‹ã¨ã„ã†ã€ä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ãªä¾‹ã‚’æŒ™ã’ã¦ã¿ã¾ã™ã€‚

```html: App.svelte
<script lang="ts">
	export let name: string;
</script>

<main>
	<h1>Hello {name}!</h1>
	<p>Visit the <a href="https://svelte.dev/tutorial">Svelte tutorial</a> to learn how to build Svelte apps.</p>
</main>
```

```ts: App.spec.ts
import "@testing-library/jest-dom";
import { render } from "@testing-library/svelte";
import App from "../App.svelte";

// h1ã‚¿ã‚°ã®æ–‡å­—åˆ—ãŒã€ŒHello test!!!!ã€ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
test("should render App component", () => {
  const { getByRole } = render(App, {
    name: "test!!!",
  });
  expect(getByRole("heading").textContent).toBe("Hello test!!!!");
});

```

### æœ‰å¿—ä½œæˆã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª/ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ã€è¨­å®šã™ã‚‹æ–¹æ³•

TODO:

# å‚è€ƒã«ã—ãŸãƒšãƒ¼ã‚¸

- [Svelte å…¬å¼ Q&A](https://svelte.dev/faq)
- [Svelte with TypeScript and Jest (Starter Project)](https://daveceddia.com/svelte-typescript-jest/)
- [Svelte Society - Unit Testing Svelte Components](https://sveltesociety.dev/recipes/testing-and-debugging/unit-testing-svelte-component)
